package main.java.ru.ylab.service;

import main.java.ru.ylab.model.AppData;

/**
 * Интерфейс для сохранения и загрузки состояния приложения.
 * <p>
 * Предоставляет абстракцию над механизмом персистентности данных.
 * Реализация может использовать сериализацию, файловую систему, БД или другие хранилища.
 * </p>
 * <p>
 * <strong>Гарантии:</strong>
 * <ul>
 *   <li>Все данные приложения сохраняются атомарно (либо всё, либо ничего)</li>
 *   <li>При загрузке восстанавливается полное состояние</li>
 *   <li>Ошибки I/O обрабатываются и логируются</li>
 *   <li>Создаются резервные копии перед перезаписью</li>
 * </ul>
 * </p>
 * <p>
 * Пример использования:
 * <pre>{@code
 * DataStorage storage = new DataStorageImpl();
 *
 * // Загруженные данные или новые, если файл не найден
 * AppData data = storage.load();
 *
 * // Работаем с данными...
 *
 * // Сохраняем при выходе
 * storage.save(data);
 * }</pre>
 * </p>
 *
 * @see AppData
 * @author Ваше Имя
 * @version 1.0
 * @since 2025-11-09
 */
public interface DataStorage {

    /**
     * Сохраняет состояние приложения в хранилище.
     * <p>
     * Перед перезаписью файла создаёт резервную копию.
     * При ошибке I/O восстанавливает данные из резервной копии.
     * </p>
     *
     * @param data состояние приложения для сохранения (не может быть {@code null})
     * @throws NullPointerException если data равен {@code null}
     * @see AppData
     */
    void save(AppData data);

    /**
     * Загружает состояние приложения из хранилища.
     * <p>
     * <strong>Поведение:</strong>
     * <ul>
     *   <li>Если файл существует и корректен — загружает данные</li>
     *   <li>Если файл повреждён — пытается загрузить из резервной копии</li>
     *   <li>Если резервная копия тоже недоступна — возвращает новый пустой {@link AppData}</li>
     *   <li>После загрузки восстанавливаются индексы и синхронизируется состояние</li>
     * </ul>
     * </p>
     *
     * @return загруженные данные приложения или новый {@link AppData}, если файл не найден (никогда не {@code null})
     * @see AppData
     */
    AppData load();

    /**
     * Проверяет, существует ли файл с данными приложения.
     * <p>
     * Используется для определения, является ли это первым запуском приложения.
     * </p>
     *
     * @return {@code true} если файл данных существует, {@code false} иначе
     */
    boolean dataExists();

    /**
     * Удаляет все файлы данных (основной и резервные копии).
     * <p>
     * <strong>Предупреждение:</strong> операция необратима. Используется только в тестировании.
     * </p>
     */
    void deleteAll();
}