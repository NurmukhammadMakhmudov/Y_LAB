
package ru.ylab.repository;

import ru.ylab.model.AuditRecord;
import ru.ylab.model.enums.Action;

import java.time.LocalDateTime;
import java.util.List;

/**
 * Интерфейс репозитория для работы с аудит-логами
 * <p>
 * Определяет все операции для логирования и отслеживания действий:
 * - Запись новых действий в лог
 * - Получение всех записей аудита
 * - Фильтрация по пользователю
 * - Фильтрация по типу действия
 * - Фильтрация по датам
 * - Удаление старых записей
 * <p>
 * Все операции выполняются через PostgreSQL с помощью JDBC.
 * ID записей генерируются автоматически с помощью SEQUENCE.
 * Каждая запись содержит временную метку (timestamp).
 *
 * @author Y.Lab
 * @author Makhmudov Nurmukhammad
 * @version 2.0
 */
public interface AuditRepository {

    /**
     * Создать новую запись аудита
     * Автоматически присваиваются ID и текущее время (timestamp)
     *
     * @param username Имя пользователя, выполнившего действие
     * @param action   Тип выполненного действия (LOGIN, LOGOUT, ADD, UPDATE, DELETE и т.д.)
     * @param details  Дополнительная информация о действии (например, ID товара, название товара)
     * @return Созданная запись аудита с назначенным ID и timestamp
     */
    AuditRecord create(String username, Action action, String details);

    /**
     * Получить все записи аудита в системе
     * Возвращает записи, отсортированные по времени (новые в начале)
     *
     * @return Список всех записей аудита
     */
    List<AuditRecord> findAll();

    /**
     * Найти все записи аудита для конкретного пользователя
     * Используется для анализа действий конкретного пользователя
     *
     * @param username Имя пользователя для фильтрации
     * @return Список всех записей аудита этого пользователя
     */
    List<AuditRecord> findByUsername(String username);

    /**
     * Найти все записи аудита по типу действия
     * Используется для анализа конкретных типов операций в системе
     *
     * @param action Тип действия для фильтрации (например, "ADD", "DELETE")
     * @return Список всех записей с указанным типом действия
     */
    List<AuditRecord> findByAction(String action);

    /**
     * Найти записи аудита после указанной даты/времени
     * Используется для анализа недавних операций
     *
     * @param timestamp Дата и время - нижняя граница поиска (результаты будут ПОСЛЕ этого времени)
     * @return Список всех записей, созданных после указанного времени
     */
    List<AuditRecord> findAfterTimestamp(LocalDateTime timestamp);

    /**
     * Получить количество записей аудита в системе
     * Может использоваться для статистики и мониторинга
     *
     * @return Общее количество записей аудита
     */
    int count();

    /**
     * Удалить записи аудита, которые старше указанной даты
     * Используется для очистки лога и управления объёмом БД
     *
     * @param timestamp Дата и время - верхняя граница удаления
     *                  Удалены будут все записи РАНЕЕ этого времени
     */
    void deleteOlderThan(LocalDateTime timestamp);
}